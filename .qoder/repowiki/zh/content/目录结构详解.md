# 目录结构详解

<cite>
**本文档中引用的文件**  
- [README.md](file://README.md)
- [package.json](file://package.json)
- [src/lib/sanity.ts](file://src/lib/sanity.ts)
- [sanity/sanity.config.ts](file://sanity/sanity.config.ts)
- [sanity/schemaTypes/index.ts](file://sanity/schemaTypes/index.ts)
- [sanity/schemaTypes/post.ts](file://sanity/schemaTypes/post.ts)
- [sanity/schemaTypes/project.ts](file://sanity/schemaTypes/project.ts)
- [sanity/schemaTypes/about.ts](file://sanity/schemaTypes/about.ts)
- [sanity/schemaTypes/author.ts](file://sanity/schemaTypes/author.ts)
- [sanity/schemaTypes/category.ts](file://sanity/schemaTypes/category.ts)
- [src/components/Header.astro](file://src/components/Header.astro)
- [src/layouts/Layout.astro](file://src/layouts/Layout.astro)
- [src/pages/index.astro](file://src/pages/index.astro)
- [scripts/build-cms.bat](file://scripts/build-cms.bat)
- [scripts/install-sanity.bat](file://scripts/install-sanity.bat)
- [scripts/fix-cms-paths.js](file://scripts/fix-cms-paths.js)
- [public/cms/index.html](file://public/cms/index.html)
</cite>

## 目录结构详解

本项目采用模块化分层架构，结合 Astro 静态站点生成器与 Sanity CMS 内容管理系统，实现前后端分离的内容驱动型网站。整体结构清晰，职责分明，便于维护与扩展。

### src/ 目录：前端源码核心

`src/` 目录存放所有前端组件、页面与样式资源，基于 Astro 框架组织。

#### components/：可复用 UI 组件库
该目录包含所有可复用的界面组件，按功能进一步细分：
- `ui/`：基础 UI 元素（如 Badge、Button、Card、SectionTitle）
- 其他组件：Header、Footer、Hero、PostCard、ProjectCard 等复合组件
- 使用 Vue.js 实现 ThemeToggle.vue，体现多框架集成能力

**Section sources**
- [src/components/Header.astro](file://src/components/Header.astro#L1-L164)

#### layouts/：页面布局模板
提供统一的页面结构框架，目前包含 `Layout.astro`，负责：
- 定义 HTML 文档结构（doctype、head、meta 标签）
- 注入全局样式 `global.css`
- 包含头部 `Header` 与底部 `Footer` 组件
- 通过 `<slot />` 实现内容占位

**Section sources**
- [src/layouts/Layout.astro](file://src/layouts/Layout.astro#L1-L59)

#### pages/：网站路由与内容页面
对应网站的各个路由，Astro 自动根据文件路径生成页面：
- `index.astro`：首页
- `blog/`：博客列表与详情页（`[slug].astro` 为动态路由）
- `projects/`：项目展示页
- `about.astro`：关于页面
- `cms.astro`：CMS 访问入口

**Section sources**
- [src/pages/index.astro](file://src/pages/index.astro#L1-L242)

#### lib/：工具与服务逻辑
存放与业务逻辑相关的工具函数与服务配置，当前核心为 `sanity.ts`，负责：
- 配置 Sanity 客户端连接（项目 ID、数据集、API 版本）
- 定义 GROQ 查询语句（获取文章、项目、作者、分类等）
- 提供数据获取辅助函数 `fetchSanity`

**Section sources**
- [src/lib/sanity.ts](file://src/lib/sanity.ts#L1-L99)

#### styles/：全局样式定义
存放 CSS 样式文件，当前仅包含 `global.css`，通过 Tailwind CSS 实现响应式设计与现代化 UI。

**Section sources**
- [src/styles/global.css](file://src/styles/global.css)

### sanity/ 目录：内容模型与 CMS 配置

该目录为 Sanity CMS 的独立配置空间，实现内容结构的定义与管理。

#### schemaTypes/：内容模型定义
定义所有内容类型（Schema），每个文件对应一种数据结构：
- `post.ts`：博客文章，包含标题、摘要、封面图、作者引用、分类数组、发布时间、正文等
- `project.ts`：项目作品，包含标题、描述、缩略图、技术栈、链接、是否精选等
- `about.ts`：关于页面，包含头像、简介、技能、经历、社交链接等
- `author.ts`：作者信息，包含姓名、头像、简介
- `category.ts`：文章分类，包含标题、别名、描述
- `index.ts`：统一导出所有 Schema 类型，供主配置引用

**Section sources**
- [sanity/schemaTypes/post.ts](file://sanity/schemaTypes/post.ts#L1-L84)
- [sanity/schemaTypes/project.ts](file://sanity/schemaTypes/project.ts#L1-L97)
- [sanity/schemaTypes/about.ts](file://sanity/schemaTypes/about.ts#L1-L70)
- [sanity/schemaTypes/author.ts](file://sanity/schemaTypes/author.ts#L1-L33)
- [sanity/schemaTypes/category.ts](file://sanity/schemaTypes/category.ts#L1-L26)
- [sanity/schemaTypes/index.ts](file://sanity/schemaTypes/index.ts#L1-L10)

#### sanity.config.ts：CMS 核心配置
定义 Sanity Studio 的运行配置：
- 项目 ID 与数据集名称
- 设置 `basePath: '/cms'`，确保构建后的 CMS 静态资源正确部署在 `/cms` 路径下
- 引入所有 Schema 类型
- 配置管理界面插件（structureTool、visionTool）

**Section sources**
- [sanity/sanity.config.ts](file://sanity/sanity.config.ts#L1-L31)

### public/cms/：CMS 静态资源输出目录

该目录存放构建后的 Sanity Studio 管理界面，供内容编辑者访问。
- `index.html`：CMS 入口文件
- `static/`：包含 JS、CSS 等静态资源
- 由 `build-cms.bat` 脚本自动生成并部署

**Section sources**
- [public/cms/index.html](file://public/cms/index.html)

### scripts/：自动化部署脚本

包含批处理脚本，用于自动化 CMS 的安装与构建流程。

#### build-cms.bat：构建并部署 CMS
执行完整 CMS 构建流程：
1. 进入 `sanity` 目录并运行 `npm run build`
2. 执行 `fix-cms-paths.js` 修复资源路径
3. 删除旧的 `public/cms` 目录
4. 将 `sanity/dist` 内容复制到 `public/cms`
5. 清理临时构建文件

**Section sources**
- [scripts/build-cms.bat](file://scripts/build-cms.bat#L1-L44)

#### install-sanity.bat：安装 CMS 依赖
用于首次设置时安装 Sanity 项目的 npm 依赖包。

**Section sources**
- [scripts/install-sanity.bat](file://scripts/install-sanity.bat#L1-L14)

#### fix-cms-paths.js：路径修复脚本
修正构建后静态资源的引用路径，确保在 `/cms` 子路径下正常访问。

**Section sources**
- [scripts/fix-cms-paths.js](file://scripts/fix-cms-paths.js)

### 项目整体架构与工作流

```mermaid
graph TD
subgraph "前端 (Astro)"
A[src/pages] --> |渲染| B[HTML 页面]
C[src/components] --> A
D[src/lib/sanity.ts] --> |GROQ 查询| E[Sanity API]
end
subgraph "CMS (Sanity)"
F[sanity/schemaTypes] --> |定义| G[内容模型]
H[sanity.config.ts] --> |配置| I[Sanity Studio]
G --> I
end
J[scripts/build-cms.bat] --> |构建| K[public/cms]
I --> |输出| K
B --> |部署| L[静态站点]
K --> |部署| L
E < --> D
```

**Diagram sources**
- [src/lib/sanity.ts](file://src/lib/sanity.ts#L1-L99)
- [sanity/sanity.config.ts](file://sanity/sanity.config.ts#L1-L31)
- [scripts/build-cms.bat](file://scripts/build-cms.bat#L1-L44)
- [public/cms/index.html](file://public/cms/index.html)

### 部署流程说明

1. **开发阶段**：
   - 前端：`npm run dev`
   - CMS：`npm run sanity-dev`
2. **构建阶段**：
   - 构建前端：`npm run build`
   - 构建 CMS：`npm run build-cms`（调用 `install-sanity.bat` 和 `build-cms.bat`）
3. **部署阶段**：
   - 将 `dist` 目录部署至静态托管服务
   - CMS 可通过 `/cms` 路径访问

**Section sources**
- [package.json](file://package.json#L5-L15)
- [README.md](file://README.md#L94-L168)